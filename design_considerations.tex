


\section{Introduction}
% This chapter discusses the design considerations for the mango 
% sorting and grading system, focusing on the technical and engineering decisions 
% required for its development. The design process aims to create a scalable, efficient, 
% and user-friendly system that leverages machine learning for accurate mango classification.
Likewise, the objective of chapter 4 is to describe the researcher's design 
consideration when developing and testing the prototype. For an overview of 
the design of the prototype, the researchers considered different computer vision models in
 classifying the ripeness and bruises together with other algorithms to determine 
 the size of the mango. Likewise, the hardware design was also taken into consideration where 
 the physical design of the conveyor belt was taken into account.
\section{Engineering Standards}
\subsection{Eletrical Certifications}
The UL Listed certification indicates that the Raspberry Pi power supply has been tested and approved by 
Underwriters Laboratories (UL), meeting safety standards for both the United States and Canada under
certification number E330985. This certification ensures that the power supply complies with established requirements for electrical safety, 
insulation, and protection against potential fire hazards. It also carries an Efficiency Level VI rating, which represents the
highest energy efficiency standard set by the U.S. Department of Energy (DOE) for external power 
supplies, ensuring minimal energy loss and optimized performance.

\subsection{Safety of Machinery}
The ISO 13850:2015 – Safety of Machinery (Emergency Stop Function, Principles for Design) standard defines 
the safety requirements for emergency stop functions in machinery. It specifies that emergency stop devices 
must be clearly visible, easily accessible, and capable of quickly and safely halting machine operations in 
the event of a malfunction or hazard. For the prototype, the stop button is located at the bench power supply
and the \acr{RPi}.

\subsection{Safety Requirements for Technology Equipment}
The IEC 62368-1:2018 / ISO 62368-1:2018 – Safety Requirements for Audio/Video, Information, and Communication 
Technology Equipment standard establishes international safety guidelines for modern electronic devices and 
their power supplies. It replaces older standards (IEC 60065 and 60950) with a hazard-based safety engineering 
approach, ensuring that equipment in the prototype like the \acr{RPi} power supply and bench power supply
are designed to prevent electrical shock, overheating, and fire risks.

\subsection{Open-source Software Compliance}
The ISO/IEC 5230e - Open-source Software Compliance ensures that organizations using open-source components in their products maintain proper documentation, 
license traceability, and transparency in software management. For components in the prototype like the \acr{RPi} operating system,
which rely on open-source ecosystems, compliance with this standard promotes responsible use and distribution of software, 
reducing legal and security risks associated with open-source code.

\section{System Architecture}
The system architecture is represented through a block diagram, showcasing modules such as image acquisition, 
preprocessing, feature extraction, machine learning model, and grading output. Each module is described in detail, 
emphasizing its role in the overall system. For instance, the image acquisition module uses high-resolution cameras 
to capture mango images, while the preprocessing module enhances image quality for better feature extraction.

\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.9\textwidth]{h_bridge_schematic}
	\caption{Hardware Schematic}
	\label{fig:h_bridge_fig}
\end{figure}

In figure \ref{fig:h_bridge_fig} presents the electronic circuit diagram,
designed using Proteus. The diagram illustrates a system where a Raspberry Pi 4
serves as the central control unit, managing four motors through a relay
mechanism. The Raspberry Pi 4, represented by a rectangular box on the left,
showcases various pin connections, including GPIO pins, power supply pins (5V
and 3V3), ground pins (GND), and communication pins (TXD, RXD, SDA, SCL).

In the center of the diagram, an 18-pin integrated circuit labeled "ULN2803A" is
depicted. This component, a Darlington transistor array, likely functions as a
buffer, providing the necessary current to drive the relays. Four relays,
designated as RL1, RL2, RL3, and RL4, are positioned on the right side of the
diagram, each connected to a motor (represented by a circle with an "M" inside)
and a +12V power source. Additionally, four resistors are placed between the
ULN2803A and the relays, serving to limit current. The circuit section
containing these resistors is labeled "4 Channel Relay Driver," indicating its
purpose.

The camera module is labeled "PICAMERA" is located in the top center of the
diagram. It is represented by a square with a circle inside, symbolizing the
camera lens. The camera module is connected to the Raspberry Pi 4 through the
CSI (Camera Serial Interface) pins. The overall circuit is designed for a 12V
system, with the +12V power supply indicated at various points. The Raspberry Pi
4's GPIO pins are used to control the relays.

\section{Hardware Considerations}
The hardware components include high-resolution cameras, lighting systems for consistent image capture, and 
microcontrollers like Raspberry Pi or Arduino for system control, actuators like DC motors to move 
the mangoes. The choice of hardware is justified based on cost, performance, and compatibility with the software framework.

\subsection{General Prototype Framework}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.9\textwidth]{systemPrototypeDiagram}
	\caption{Prototype Framework}
	\label{fig:prototypeDiagram_fig}
\end{figure}

The Figure~\ref{fig:prototypeDiagram_fig} presents the overall prototype layout of the automated Carabao
mango sorter and grader. The diagram illustrates the flow of operations from
mango loading onto the conveyor belt to sorting them. It illustrates the major
elements of the system, that is, the image acquisition area, lighting system,
camera module, Raspberry Pi controller, and mechanical actuators. The layout
illustrates how all the subsystems work together to ensure mangoes are scanned,
processed, sorted based on ripeness, size, and bruises, and eventually sorted
based on the calculated priority score. The layout served as the basis for
actual prototype development.



\subsection{Prototype Flowchart}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.40\textwidth]{mainFlowchart}
	\caption{Prototype Main Flowchart}
	\label{fig:pro2typeDiagram_fig}
\end{figure}

The flowchart in Figure~\ref{fig:pro2typeDiagram_fig} represents the overall operational logic of the
mango grading and sorting system. The process starts with system initialization,
where the camera and lighting modules are switched on and the machine learning
algorithms are initialised. The input of the user priority values as well as the
detection of the mango on the conveyor belt triggers the capture of both the top
and bottom cheek of the mango. The captured image is processed using machine
learning algorithms to determine its ripeness, size, and bruises. Depending on
these classifications along with priority weights given by the user, the system
calculates an overall score. Once this calculation is done, the mango is routed
to the respective bin through the respective actuator. Having this logical
sequence is important to know the system's decision-making and automation
process.


\subsection{Prototype 3D Model}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.60\textwidth]{3D_Drawing}
	\caption{Initial 3D Model of the Prototype}
	\label{fig:3dModel_fig}
\end{figure}

Figure~\ref{fig:3dModel_fig} shows the first 3D model of the initial physical prototype developed
for the sorting and grading system. This model shows the skeleton of the system
and where the conveyor system is going to be placed strategically in order to
flip the mango for image acquisition. It is useful for where the hardware
components would be arranged and assembled. This 3D model helped the researchers
visualize the spacing, alignment, and where to mount parts before assembling the
prototype making sure all electronic and mechanical components are effectively
integrated.

\subsection{Hardware Specifications}

\subsubsection{Raspberry Pi}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{rpi4b}
	\caption{Raspberry Pi 4 Model B}
	\label{fig:rpi4b_fig}
\end{figure}

The Raspberry Pi 4 Model B serves as the central processing unit of the prototype, chosen for its compact form factor, 
affordability, and substantial computational capability required for image processing and machine learning tasks. 
The board's essential features include GPIO pins for connecting sensors, actuators, and relays, along with USB and 
HDMI ports for peripheral integration. Its support for a full operating system enables it to efficiently manage both the user interface 
and the core control logic of the mango grading system.

\textbf{Specifications:}
\begin{itemize}
    \item SoC: Broadcom BCM2711
    \item \acr{CPU}: Quad-core ARM Cortex-A72 (64-bit)
    \item Clock Speed: 1.5 GHz (base, overclockable)
    \item RAM: 8GB LPDDR4-3200 SDRAM
    \item Wireless: Dual-band 2.4 GHz / 5 GHz Wi-Fi (802.11ac)
    \item Bluetooth: Bluetooth 5.0 (BLE support)
    \item Ethernet: Gigabit Ethernet (full throughput)
    \item USB: 2 x USB 3.0 ports and 2 x USB 2.0 ports
    \item Video Output: 2 x micro-HDMI ports (supports 4K @ 60Hz, dual 4K display capability)
    \item Audio: 3.5mm audio/video composite jack
    \item Storage: MicroSD card slot (supports booting via SD card or USB)
    \item GPIO: 40-pin GPIO header (backward-compatible with older models)
    \item Camera/Display: CSI (camera) and DSI (display) ports
    \item Power Input: USB-C (5V/3A recommended)
    \item Power Consumption: ~3W idle, up to 7.5W under load
\end{itemize}

\subsubsection{Raspberry Pi Camera}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{rpi_cam}
	\caption{Raspberry Pi Camera Module Version 2}
	\label{fig:rpi_cam_fig}
\end{figure}
This high-quality camera module is specifically engineered for the Raspberry
Pi platform, offering 8-megapixel still image capture and
video recording capabilities at 1080p (30fps), 720p (60fps), and 480p (90fps).
It incorporates a fixed-focus lens with a 62.2-degree diagonal field of view and a 1/4-inch optical format. 
Compatibility with Python libraries like Picamera and OpenCV facilitates seamless image capture and processing. 
Its selection was driven by its small size, straightforward integration, and capacity for high-resolution imaging.

\textbf{Specifications:}
\begin{itemize}
    \item Sensor: Sony IMX219PQ 8-megapixel CMOS sensor.
    \item Still Images Resolution: 8 MP (3280 x 2464 pixels).
    \item Video Resolution: Supports up to 1080p @ 30fps, 720p @ 60fps, and 480p @ 90fps.
    \item Focus: Fixed-focus lens (manual focus adjustment not supported without physical modification).
    \item Lens Size: 1/4-inch optical format.
    \item Field of View (FoV): Diagonal 62.2 degrees.
    \item Interface: Connected via 15-pin ribbon cable to the Raspberry Pi's CSI (Camera Serial Interface) port.
    \item APIs/Libraries: Supports Python libraries such as Picamera and OpenCV for image capture and processing.
    \item Dimensions: 25 mm x 24 mm x 9 mm.
\end{itemize}

\subsubsection{DC Motor}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{dc_motor}
	\caption{12 Volt DC Gear Motor}
	\label{fig:dc_motor_fig}
\end{figure}
This compact 12V DC gear motor delivers high torque and operates quietly, making it suitable for robotics, automation, 
and industrial control systems. Its spur gear design ensures a high reduction ratio for enhanced torque. Engineered for continuous duty,
it maintains low power consumption during standard operation and offers reliability under high-temperature conditions. 

\textbf{Specifications:}
\begin{itemize}
    \item Gearbox Type: Spur gear design
    \item Operating Voltage: 12V (operational range: 6-12V)
    \item No-load Current Consumption: 0.8A
    \item Rated Current Draw: 3A (under standard load)
    \item No-load Speed: 282 RPM (maximum)
    \item Operating Speed: 248 RPM (under rated load)
    \item Torque Output: 18 kg-cm (rated)
    \item Stall Torque: 60 kg-cm (maximum)
    \item Power Rating: 50W (maximum)
    \item Unit Weight: 350 grams
\end{itemize}


\subsubsection{MicroSD Card}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{sdCard}
	\caption{SanDisk Ultra MicroSD Card}
	\label{fig:sdCard_fig}
\end{figure}
This compact, high-capacity SanDisk Ultra MicroSD card provides secure digital storage for devices like digital cameras, 
smartphones, and tablets. Its high-speed data transfer rate is optimal for handling large files such as images and videos. 
The card was chosen for the prototype's storage system due to its substantial capacity, reliable data protection, and user-friendly design.

\textbf{Specifications:}
\begin{itemize}
    \item Capacity: 256GB
    \item Type: MicroSDXC (Secure Digital eXtended Capacity)
    \item Form Factor: MicroSD (11mm x 15mm x 1mm)
    \item File System: Pre-formatted exFAT
\end{itemize}

\subsubsection{LED Lights}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{led}
	\caption{LED Light Strip}
	\label{fig:led_fig}
\end{figure}
The LED strips were implemented to deliver uniform illumination for image capture, 
which is crucial for precise color representation and feature extraction. Their selection was based on exceptional energy 
efficiency, extended operational lifespan, and consistent light output quality.

\textbf{Specifications:}
\begin{itemize}
    \item Power Input: 5V DC (USB-powered, compatible with laptops, power banks, or USB adapters).
    \item Waterproof Design: Suitable for indoor/outdoor use.
    \item LED Type: SMD 2835 (surface-mount diodes for high brightness and efficiency).
    \item Color Type: White (cool white)
    \item Length: 1m 
    \item Beam Angle: 120°
    \item Operating Temperature: -25°C to 60°C.
    \item Storage Temperature: -40°C to 80°C.
\end{itemize}


\subsubsection{Power Supply}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{Power_Supply}
	\caption{Bench Power Supply}
	\label{fig:Power_Supply_fig}
\end{figure}
This bench power supply is an adaptable and regulated source that delivers stable voltage and current 
for diverse electronic projects. Designed for testing purposes, it enables precise setting of voltage and
current parameters. Its versatility, user-friendly operation, and accurate control capabilities led 
to its selection.

\textbf{Specifications:}
\begin{itemize}
    \item Type: SMPS (Switch-Mode Power Supply)
    \item Input: 110V AC, 50/60Hz (U.S. Standard)
    \item Output Range: 0-30V DC / 0-5A DC
    \item Voltage Precision: ±0.010V (10 mV) resolution
    \item Current Precision: ±0.001A (1 mA) resolution
    \item Power Precision: ±0.1W resolution
    \item Weight: 5 lbs (2.27 kg)
    \item Dimensions: 11.1" x 4.92" x 6.14" (28.2 cm x 12.5 cm x 15.6 cm)
    \item Maximum Power: 195W
    \item Power Source: AC input only
\end{itemize}

\subsubsection{4 Channel Relay Module}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{relay_module}
	\caption{4 Channel Relay Module}
	\label{fig:relay_module_fig}
\end{figure}
This compact and versatile relay board enables control of multiple devices through a single microcontroller. 
It was chosen for its small footprint, operational simplicity, and capacity to manage several devices concurrently. 
Designed for compatibility with microcontrollers like Arduino and Raspberry Pi, it integrates smoothly into the prototype.

\textbf{Specifications:}
\begin{itemize}
    \item Operating Voltage: 5V DC (compatible with Arduino, Raspberry Pi, and other microcontrollers).
    \item Number of Relays: 4 independent channels.
    \item Relay Type: Electromechanical (mechanical switching).
    \item Max AC Load: 10A @ 250V AC (resistive).
    \item Max DC Load: 10A @ 30V DC (resistive).
    \item Contact Type: SPDT (Single Pole Double Throw) - NO (Normally Open), NC (Normally Closed), COM (Common).
    \item Dimensions: ~50mm x 70mm x 20mm 
    \item Weight: ~50-80 grams.
    \item Status LEDs: Individual LEDs for each relay (indicates ON/OFF state).
    \item Input Pins: 4 digital control pins (one per relay).
    \item Output Terminals: Screw terminals for connecting loads (NO/NC/COM).
\end{itemize}

\subsubsection{\acr{RPi} Power Supply}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{/sorting/PSU1}
  \caption{Power Supply for the \acr{RPi}}
	\label{fig:rpi_power_supply}
\end{figure}
This official Raspberry Pi power supply is optimally designed for the Raspberry Pi 4 Model B, 
compatible with all its memory variants. Delivering 5.1V at 3A via a USB-C connector, it ensures reliable performance. 
The OKdo-branded unit provides stable power suitable for the Raspberry Pi 4, other single-board computers, and mobile devices, 
and includes comprehensive over-temperature protection with global plug compatibility.

\textbf{Features:}
\begin{itemize}
    \item Compatible with Raspberry Pi 4 Model B
    \item Color: Black
    \item USB-C connector
    \item US Plug
    \item Over temperature protection
    \item Short circuit protection
    \item Over current protection
    \item Over voltage protection
\end{itemize}

\textbf{Specifications:}
\begin{itemize}
    \item Input Voltage: 100-264V AC
    \item Input Frequency Range: 47-63Hz
    \item Input Current: 600mA Max
    \item Output Voltage: 5.1V DC
    \item Output Current: 3A
    \item Power Rating: 15.3W
    \item Output Connector: USB Type C
    \item Output Cable Length: 1.5M
    \item Number of Outputs: 1
    \item Unload Standby Power: 0.1W
    \item Max Ripple Noise: 50-240mVp-p
\end{itemize}

\subsubsection{Mini Conveyor Single Narrow}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{/sorting/conveyor1}
	\caption{Single Narrow Mini Conveyor}
	\label{fig:single_narrow_conveyor}
\end{figure}
This miniature conveyor system facilitates the creation of compact factory setups for presentations and prototyping. 
The single narrow configuration is particularly suited for small-scale automation tasks and experimental applications.

\textbf{Specifications:}
\begin{itemize}
    \item Belt Dimensions: 43.4 x 9 x 9 cm (L x W x H)
    \item Chassis Dimensions: 46 x 10.5 x 11 cm (L x W x H)
    \item Type: Single narrow conveyor
    \item Application: Prototyping and miniature factory setups
\end{itemize}

\subsubsection{Mini Conveyor Double Narrow}
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{/sorting/conveyor2}
	\caption{Double Narrow Mini Conveyor}
	\label{fig:double_narrow_conveyor}
\end{figure}
This miniature conveyor system enables the development of small-scale factory environments for demonstrations and prototyping. 
The double narrow version offers increased length to accommodate more sophisticated automation processes and continuous operation requirements.

\textbf{Specifications:}
\begin{itemize}
    \item Belt Dimensions: 85.5 x 9 x 9 cm (L x W x H)
    \item Chassis Dimensions: 88 x 10.5 x 11 cm (L x W x H)
    \item Type: Double narrow conveyor
    \item Application: Extended prototyping and miniature factory setups
\end{itemize}

\section{Software Considerations}
The software stack includes Python for programming PyTorch for machine learning and OpenCV for image processing. 
These tools are selected for their robustness, ease of use, and extensive community support, ensuring efficient system development.

\subsection{PyTorch}

PyTorch is an open-source deep-learning framework used in this project for
implementing and running the convolutional neural networks responsible for
classifying mango ripeness and detecting bruises. Its dynamic computational
graph and GPU acceleration support made it an ideal choice for real-time image
classification. Its simplicity and flexibility also allowed for easy integration
with the Raspberry Pi which is important as it is the main processing unit for
the system.

\subsection{OpenCV}
Open Source Computer Vision Library or OpenCV is utilized in the system for all
image processing tasks, particularly in preprocessing steps such as background
subtraction, thresholding, edge detection, and contour analysis. These
operations are essential for calculating the real-world dimensions of the mango.
OpenCV was utilized primarily because of its diverse set of functions,
performance optimization, and ease of use making it a core tool for enabling
accurate and fast computer vision processing within the prototype.

\subsection{CustomTkinter}
CustomTkinter is a modern alternative to the standard Tkinter library, and is
used to build the graphical user interface (GUI) of the system. It provides a
more polished and customizable visual appearance while retaining the simplicity
of Tkinter. With features such as styled buttons, frames, and labels,
CustomTkinter allowed for the creation of a user-friendly interface that
supports real-time display of classification results, priority scoring inputs,
and system status updates.


\section{User Interface}
A \gls{UI} is designed to display grading results, system status. Wireframes illustrate the layout, ensuring usability and accessibility for operators. 
Likewise, a \gls{GUI} is also used to allow users to customize the system's grading priorities.

\section{Summary} \label{sec:summary_of_design}
% This chapter outlined the key design considerations, including system architecture, hardware and software choices, and validation methods. These decisions are critical for developing a reliable and efficient mango sorting and grading system.

This chapter outlines the foundational design and engineering decisions for the
automated mango grading system. The design process prioritized creating a scalable,
efficient, and user-friendly system, guided by established engineering standards for
safety and compliance. These standards include UL Listing for the power supply,
ISO 13850 for the emergency stop function, and IEC 62368-1 for
the safety of the technology equipment.

The system architecture is built around a \acr{RPi} 4 Model
B as the central controller, which manages a network of hardware
components. The core hardware includes a \acr{RPi} Camera for image
acquisition, 12V DC gear motors to drive the conveyor belts, a
4-channel relay module for motor control, and LED strips to
ensure consistent lighting. A detailed hardware schematic and a 3D model
were created to plan the integration of these electronic and mechanical
parts effectively.

On the software side, the system leverages a robust stack including
PyTorch for running the deep learning models, OpenCV for image
processing tasks like size determination, and CustomTkinter to build an
intuitive GUI. This GUI allows operators to
input grading priorities and view results. The overall
operational logic, from mango detection and image capture to classification
and sorting, is defined by a clear system flowchart. In summary,
this chapter details the careful selection and integration of both
hardware and software components to form a coherent, safe, and
functional prototype.










